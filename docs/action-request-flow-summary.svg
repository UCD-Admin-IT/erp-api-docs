<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="965px" preserveAspectRatio="none" style="width:1069px;height:965px;background:#FFFFFF;" version="1.1" viewBox="0 0 1069 965" width="1069px" zoomAndPan="magnify"><defs/><g><rect height="29.124" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="265" x="398.25" y="10"/><text fill="#000000" font-family="Avenir" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="255" x="403.25" y="29">Action Request Flow Sequence Diagram</text><rect fill="#FFE599" height="177.77" style="stroke:#1D4776;stroke-width:1.0;" width="10" x="294.5" y="256.548"/><rect fill="#FFE599" height="96.64" style="stroke:#1D4776;stroke-width:1.0;" width="10" x="294.5" y="750.042"/><rect fill="#FFE599" height="138.496" style="stroke:#1D4776;stroke-width:1.0;" width="10" x="887.5" y="536.762"/><rect fill="#FFE599" height="27.66" style="stroke:#1D4776;stroke-width:1.0;" width="10" x="1014.5" y="619.938"/><line style="stroke:#1D4776;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="133" x2="133" y1="124.248" y2="864.682"/><line style="stroke:#1D4776;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="299" x2="299" y1="124.248" y2="864.682"/><line style="stroke:#1D4776;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="531.5" x2="531.5" y1="124.248" y2="864.682"/><line style="stroke:#1D4776;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="729" x2="729" y1="124.248" y2="864.682"/><line style="stroke:#1D4776;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="892.5" x2="892.5" y1="124.248" y2="864.682"/><line style="stroke:#1D4776;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1019.5" x2="1019.5" y1="124.248" y2="864.682"/><text fill="#002851" font-family="Avenir" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="91" x="85" y="119.124">API Consumer</text><ellipse cx="133.5" cy="53.624" fill="#FFE599" rx="8" ry="8" style="stroke:#033266;stroke-width:0.5;"/><path d="M133.5,61.624 L133.5,88.624 M120.5,69.624 L146.5,69.624 M133.5,88.624 L120.5,103.624 M133.5,88.624 L146.5,103.624 " fill="none" style="stroke:#033266;stroke-width:0.5;"/><text fill="#002851" font-family="Avenir" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="91" x="85" y="877.682">API Consumer</text><ellipse cx="133.5" cy="891.306" fill="#FFE599" rx="8" ry="8" style="stroke:#033266;stroke-width:0.5;"/><path d="M133.5,899.306 L133.5,926.306 M120.5,907.306 L146.5,907.306 M133.5,926.306 L120.5,941.306 M133.5,926.306 L146.5,941.306 " fill="none" style="stroke:#033266;stroke-width:0.5;"/><text fill="#002851" font-family="Avenir" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="67" x="263" y="119.124">API Server</text><ellipse cx="299.5" cy="89.124" fill="#FFE599" rx="12" ry="12" style="stroke:#000000;stroke-width:0.5;"/><polygon fill="#000000" points="295.5,77.124,301.5,72.124,299.5,77.124,301.5,82.124,295.5,77.124" style="stroke:#000000;stroke-width:1.0;"/><text fill="#002851" font-family="Avenir" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="67" x="263" y="877.682">API Server</text><ellipse cx="299.5" cy="898.806" fill="#FFE599" rx="12" ry="12" style="stroke:#000000;stroke-width:0.5;"/><polygon fill="#000000" points="295.5,886.806,301.5,881.806,299.5,886.806,301.5,891.806,295.5,886.806" style="stroke:#000000;stroke-width:1.0;"/><text fill="#002851" font-family="Avenir" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="90" x="483.5" y="119.124">Request Store</text><path d="M513.5,69.124 C513.5,59.124 531.5,59.124 531.5,59.124 C531.5,59.124 549.5,59.124 549.5,69.124 L549.5,95.124 C549.5,105.124 531.5,105.124 531.5,105.124 C531.5,105.124 513.5,105.124 513.5,95.124 L513.5,69.124 " fill="#FFE599" style="stroke:#000000;stroke-width:1.5;"/><path d="M513.5,69.124 C513.5,79.124 531.5,79.124 531.5,79.124 C531.5,79.124 549.5,79.124 549.5,69.124 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#002851" font-family="Avenir" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="90" x="483.5" y="877.682">Request Store</text><path d="M513.5,892.806 C513.5,882.806 531.5,882.806 531.5,882.806 C531.5,882.806 549.5,882.806 549.5,892.806 L549.5,918.806 C549.5,928.806 531.5,928.806 531.5,928.806 C531.5,928.806 513.5,928.806 513.5,918.806 L513.5,892.806 " fill="#FFE599" style="stroke:#000000;stroke-width:1.5;"/><path d="M513.5,892.806 C513.5,902.806 531.5,902.806 531.5,902.806 C531.5,902.806 549.5,902.806 549.5,892.806 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><path d="M680,95.124 L779,95.124 C784,95.124 784,109.686 784,109.686 C784,109.686 784,124.248 779,124.248 L680,124.248 C675,124.248 675,109.686 675,109.686 C675,109.686 675,95.124 680,95.124 " fill="#FFE599" style="stroke:#000000;stroke-width:0.5;"/><path d="M779,95.124 C774,95.124 774,109.686 774,109.686 C774,124.248 779,124.248 779,124.248 " fill="none" style="stroke:#000000;stroke-width:0.5;"/><text fill="#002851" font-family="Avenir" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="89" x="680" y="114.124">Action Queue</text><path d="M680,863.682 L779,863.682 C784,863.682 784,878.244 784,878.244 C784,878.244 784,892.806 779,892.806 L680,892.806 C675,892.806 675,878.244 675,878.244 C675,878.244 675,863.682 680,863.682 " fill="#FFE599" style="stroke:#000000;stroke-width:0.5;"/><path d="M779,863.682 C774,863.682 774,878.244 774,878.244 C774,892.806 779,892.806 779,892.806 " fill="none" style="stroke:#000000;stroke-width:0.5;"/><text fill="#002851" font-family="Avenir" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="89" x="680" y="882.682">Action Queue</text><text fill="#002851" font-family="Avenir" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="112" x="833.5" y="119.124">Action Processors</text><ellipse cx="892.5" cy="89.124" fill="#FFE599" rx="12" ry="12" style="stroke:#000000;stroke-width:0.5;"/><polygon fill="#000000" points="888.5,77.124,894.5,72.124,892.5,77.124,894.5,82.124,888.5,77.124" style="stroke:#000000;stroke-width:1.0;"/><text fill="#002851" font-family="Avenir" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="112" x="833.5" y="877.682">Action Processors</text><ellipse cx="892.5" cy="898.806" fill="#FFE599" rx="12" ry="12" style="stroke:#000000;stroke-width:0.5;"/><polygon fill="#000000" points="888.5,886.806,894.5,881.806,892.5,886.806,894.5,891.806,888.5,886.806" style="stroke:#000000;stroke-width:1.0;"/><text fill="#002851" font-family="Avenir" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="70" x="981.5" y="119.124">Oracle ERP</text><ellipse cx="1019.5" cy="89.124" fill="#FFE599" rx="12" ry="12" style="stroke:#000000;stroke-width:0.5;"/><line style="stroke:#000000;stroke-width:0.5;" x1="1007.5" x2="1031.5" y1="103.124" y2="103.124"/><text fill="#002851" font-family="Avenir" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="70" x="981.5" y="877.682">Oracle ERP</text><ellipse cx="1019.5" cy="898.806" fill="#FFE599" rx="12" ry="12" style="stroke:#000000;stroke-width:0.5;"/><line style="stroke:#000000;stroke-width:0.5;" x1="1007.5" x2="1031.5" y1="912.806" y2="912.806"/><rect fill="#FFE599" height="177.77" style="stroke:#1D4776;stroke-width:1.0;" width="10" x="294.5" y="256.548"/><rect fill="#FFE599" height="96.64" style="stroke:#1D4776;stroke-width:1.0;" width="10" x="294.5" y="750.042"/><rect fill="#FFE599" height="138.496" style="stroke:#1D4776;stroke-width:1.0;" width="10" x="887.5" y="536.762"/><rect fill="#FFE599" height="27.66" style="stroke:#1D4776;stroke-width:1.0;" width="10" x="1014.5" y="619.938"/><path d="M5,139.248 L5,184.248 L429,184.248 L429,149.248 L419,139.248 L5,139.248 " fill="#CDD6E0" style="stroke:#181818;stroke-width:0.5;"/><path d="M419,139.248 L419,149.248 L429,149.248 L419,139.248 " fill="#CDD6E0" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="Avenir" font-size="13" lengthAdjust="spacing" textLength="364" x="11" y="157.248">Consumer has previously been provided with an authentication</text><text fill="#000000" font-family="Avenir" font-size="13" lengthAdjust="spacing" textLength="403" x="11" y="175.006">token and provides their authentication header in every HTTP request.</text><rect fill="#CDD6E0" height="3" style="stroke:#CDD6E0;stroke-width:1.0;" width="1062.5" x="0" y="212.326"/><line style="stroke:#002851;stroke-width:1.0;" x1="0" x2="1062.5" y1="212.326" y2="212.326"/><line style="stroke:#002851;stroke-width:1.0;" x1="0" x2="1062.5" y1="215.326" y2="215.326"/><rect fill="#CDD6E0" height="27.124" style="stroke:#002851;stroke-width:2.0;" width="152" x="455.25" y="199.764"/><text fill="#000000" font-family="Avenir" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="134" x="461.25" y="217.764">Initial Action Request</text><polygon fill="#002851" points="282.5,252.548,292.5,256.548,282.5,260.548,286.5,256.548" style="stroke:#002851;stroke-width:1.0;"/><line style="stroke:#002851;stroke-width:2.0;" x1="133.5" x2="288.5" y1="256.548" y2="256.548"/><text fill="#4C4C4C" font-family="Avenir" font-size="10" font-weight="bold" lengthAdjust="spacing" textLength="12" x="140.5" y="250.888">1 :</text><text fill="#4C4C4C" font-family="Avenir" font-size="10" lengthAdjust="spacing" textLength="100" x="159.5" y="250.888">GraphQL API Request</text><path d="M168,269.548 L168,367.548 L431,367.548 L431,279.548 L421,269.548 L168,269.548 " fill="#CDD6E0" style="stroke:#181818;stroke-width:0.5;"/><path d="M421,269.548 L421,279.548 L431,279.548 L421,269.548 " fill="#CDD6E0" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="179.5" cy="284.806" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Avenir" font-size="13" lengthAdjust="spacing" textLength="113" x="186" y="287.548">Validates X-API-Key</text><ellipse cx="179.5" cy="302.564" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Avenir" font-size="13" lengthAdjust="spacing" textLength="193" x="186" y="305.306">Obtains Consumer's GraphQL ID</text><ellipse cx="179.5" cy="320.322" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Avenir" font-size="13" lengthAdjust="spacing" textLength="230" x="186" y="323.064">Obtains and Applies Consumer's AuthZ</text><ellipse cx="179.5" cy="338.08" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Avenir" font-size="13" lengthAdjust="spacing" textLength="130" x="186" y="340.822">Validates request data</text><ellipse cx="179.5" cy="355.838" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Avenir" font-size="13" lengthAdjust="spacing" textLength="172" x="186" y="358.58">Assigns unique ID to Request</text><polygon fill="#002851" points="519.5,388.998,529.5,392.998,519.5,396.998,523.5,392.998" style="stroke:#002851;stroke-width:1.0;"/><line style="stroke:#002851;stroke-width:2.0;" x1="304.5" x2="525.5" y1="392.998" y2="392.998"/><text fill="#4C4C4C" font-family="Avenir" font-size="10" font-weight="bold" lengthAdjust="spacing" textLength="12" x="311.5" y="387.338">2 :</text><text fill="#4C4C4C" font-family="Avenir" font-size="10" lengthAdjust="spacing" textLength="184" x="330.5" y="387.338">Submits request to queue for processing</text><polygon fill="#002851" points="144.5,430.318,134.5,434.318,144.5,438.318,140.5,434.318" style="stroke:#002851;stroke-width:1.0;"/><line style="stroke:#002851;stroke-width:2.0;stroke-dasharray:2.0,2.0;" x1="138.5" x2="298.5" y1="434.318" y2="434.318"/><text fill="#4C4C4C" font-family="Avenir" font-size="10" font-weight="bold" lengthAdjust="spacing" textLength="12" x="150.5" y="421.828">3 :</text><text fill="#4C4C4C" font-family="Avenir" font-size="10" lengthAdjust="spacing" textLength="112" x="169.5" y="414.998">Returns response with ID</text><text fill="#4C4C4C" font-family="Avenir" font-size="10" lengthAdjust="spacing" textLength="95" x="169.5" y="428.658">and status check info</text><rect fill="#CDD6E0" height="3" style="stroke:#CDD6E0;stroke-width:1.0;" width="1062.5" x="0" y="464.88"/><line style="stroke:#002851;stroke-width:1.0;" x1="0" x2="1062.5" y1="464.88" y2="464.88"/><line style="stroke:#002851;stroke-width:1.0;" x1="0" x2="1062.5" y1="467.88" y2="467.88"/><rect fill="#CDD6E0" height="27.124" style="stroke:#002851;stroke-width:2.0;" width="146" x="458.25" y="452.318"/><text fill="#000000" font-family="Avenir" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="128" x="464.25" y="470.318">Message Processing</text><polygon fill="#002851" points="717.5,505.102,727.5,509.102,717.5,513.102,721.5,509.102" style="stroke:#002851;stroke-width:1.0;"/><line style="stroke:#002851;stroke-width:2.0;" x1="531.5" x2="723.5" y1="509.102" y2="509.102"/><text fill="#4C4C4C" font-family="Avenir" font-size="10" font-weight="bold" lengthAdjust="spacing" textLength="12" x="538.5" y="503.442">4 :</text><text fill="#4C4C4C" font-family="Avenir" font-size="10" lengthAdjust="spacing" textLength="155" x="557.5" y="503.442">Pulls pending requests into queue</text><polygon fill="#002851" points="875.5,532.762,885.5,536.762,875.5,540.762,879.5,536.762" style="stroke:#002851;stroke-width:1.0;"/><line style="stroke:#002851;stroke-width:2.0;" x1="729.5" x2="881.5" y1="536.762" y2="536.762"/><text fill="#4C4C4C" font-family="Avenir" font-size="10" font-weight="bold" lengthAdjust="spacing" textLength="12" x="736.5" y="531.102">5 :</text><text fill="#4C4C4C" font-family="Avenir" font-size="10" lengthAdjust="spacing" textLength="120" x="755.5" y="531.102">Processor picks up request</text><path d="M763,549.762 L763,594.762 L1022,594.762 L1022,559.762 L1012,549.762 L763,549.762 " fill="#CDD6E0" style="stroke:#181818;stroke-width:0.5;"/><path d="M1012,549.762 L1012,559.762 L1022,559.762 L1012,549.762 " fill="#CDD6E0" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="774.5" cy="565.02" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Avenir" font-size="13" lengthAdjust="spacing" textLength="88" x="781" y="567.762">Data validation</text><ellipse cx="774.5" cy="582.778" fill="#000000" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.0;"/><text fill="#000000" font-family="Avenir" font-size="13" lengthAdjust="spacing" textLength="226" x="781" y="585.52">Formats request for submission to ERP</text><polygon fill="#002851" points="1002.5,615.938,1012.5,619.938,1002.5,623.938,1006.5,619.938" style="stroke:#002851;stroke-width:1.0;"/><line style="stroke:#002851;stroke-width:2.0;" x1="897.5" x2="1008.5" y1="619.938" y2="619.938"/><text fill="#4C4C4C" font-family="Avenir" font-size="10" font-weight="bold" lengthAdjust="spacing" textLength="12" x="904.5" y="614.278">6 :</text><text fill="#4C4C4C" font-family="Avenir" font-size="10" lengthAdjust="spacing" textLength="76" x="923.5" y="614.278">Submits Request</text><polygon fill="#002851" points="908.5,643.598,898.5,647.598,908.5,651.598,904.5,647.598" style="stroke:#002851;stroke-width:1.0;"/><line style="stroke:#002851;stroke-width:2.0;stroke-dasharray:2.0,2.0;" x1="902.5" x2="1018.5" y1="647.598" y2="647.598"/><text fill="#4C4C4C" font-family="Avenir" font-size="10" font-weight="bold" lengthAdjust="spacing" textLength="12" x="914.5" y="641.938">7 :</text><text fill="#4C4C4C" font-family="Avenir" font-size="10" lengthAdjust="spacing" textLength="74" x="933.5" y="641.938">Receives Results</text><polygon fill="#002851" points="542.5,671.258,532.5,675.258,542.5,679.258,538.5,675.258" style="stroke:#002851;stroke-width:1.0;"/><line style="stroke:#002851;stroke-width:2.0;" x1="536.5" x2="891.5" y1="675.258" y2="675.258"/><text fill="#4C4C4C" font-family="Avenir" font-size="10" font-weight="bold" lengthAdjust="spacing" textLength="12" x="548.5" y="669.598">8 :</text><text fill="#4C4C4C" font-family="Avenir" font-size="10" lengthAdjust="spacing" textLength="156" x="567.5" y="669.598">Updates Request status and results</text><rect fill="#CDD6E0" height="3" style="stroke:#CDD6E0;stroke-width:1.0;" width="1062.5" x="0" y="705.82"/><line style="stroke:#002851;stroke-width:1.0;" x1="0" x2="1062.5" y1="705.82" y2="705.82"/><line style="stroke:#002851;stroke-width:1.0;" x1="0" x2="1062.5" y1="708.82" y2="708.82"/><rect fill="#CDD6E0" height="27.124" style="stroke:#002851;stroke-width:2.0;" width="180" x="441.25" y="693.258"/><text fill="#000000" font-family="Avenir" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="162" x="447.25" y="711.258">Action Request Response</text><polygon fill="#002851" points="282.5,746.042,292.5,750.042,282.5,754.042,286.5,750.042" style="stroke:#002851;stroke-width:1.0;"/><line style="stroke:#002851;stroke-width:2.0;" x1="133.5" x2="288.5" y1="750.042" y2="750.042"/><text fill="#4C4C4C" font-family="Avenir" font-size="10" font-weight="bold" lengthAdjust="spacing" textLength="12" x="140.5" y="744.382">9 :</text><text fill="#4C4C4C" font-family="Avenir" font-size="10" lengthAdjust="spacing" textLength="100" x="159.5" y="744.382">GraphQL API Request</text><polygon fill="#002851" points="519.5,773.702,529.5,777.702,519.5,781.702,523.5,777.702" style="stroke:#002851;stroke-width:1.0;"/><line style="stroke:#002851;stroke-width:2.0;" x1="304.5" x2="525.5" y1="777.702" y2="777.702"/><text fill="#4C4C4C" font-family="Avenir" font-size="10" font-weight="bold" lengthAdjust="spacing" textLength="18" x="311.5" y="772.042">10 :</text><text fill="#4C4C4C" font-family="Avenir" font-size="10" lengthAdjust="spacing" textLength="111" x="336.5" y="772.042">Looks up Request Status</text><polygon fill="#002851" points="315.5,801.362,305.5,805.362,315.5,809.362,311.5,805.362" style="stroke:#002851;stroke-width:1.0;"/><line style="stroke:#002851;stroke-width:2.0;stroke-dasharray:2.0,2.0;" x1="309.5" x2="530.5" y1="805.362" y2="805.362"/><text fill="#4C4C4C" font-family="Avenir" font-size="10" font-weight="bold" lengthAdjust="spacing" textLength="18" x="321.5" y="799.702">11 :</text><text fill="#4C4C4C" font-family="Avenir" font-size="10" lengthAdjust="spacing" textLength="110" x="346.5" y="799.702">Receives Request Status</text><polygon fill="#002851" points="144.5,842.682,134.5,846.682,144.5,850.682,140.5,846.682" style="stroke:#002851;stroke-width:1.0;"/><line style="stroke:#002851;stroke-width:2.0;stroke-dasharray:2.0,2.0;" x1="138.5" x2="298.5" y1="846.682" y2="846.682"/><text fill="#4C4C4C" font-family="Avenir" font-size="10" font-weight="bold" lengthAdjust="spacing" textLength="18" x="150.5" y="834.192">12 :</text><text fill="#4C4C4C" font-family="Avenir" font-size="10" lengthAdjust="spacing" textLength="112" x="175.5" y="827.362">Returns response with ID</text><text fill="#4C4C4C" font-family="Avenir" font-size="10" lengthAdjust="spacing" textLength="95" x="175.5" y="841.022">and status check info</text><rect height="13.66" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="154" x="453.75" y="943.806"/><text fill="#888888" font-family="Avenir" font-size="10" lengthAdjust="spacing" textLength="154" x="453.75" y="953.806">Author: Jonathan Keller 2/1/2022</text><!--MD5=[862091b8dd833189ae927e31b6269947]
@startuml action-request-flow

!include ucd_style.iuml

title Action Request Flow Sequence Diagram
center footer Author: Jonathan Keller 2/1/2022

actor    "API Consumer"        as Consumer
control  "API Server"          as dataserver
database "Request Store"       as db
queue    "Action Queue"        as kafka
control  "Action Processors"   as processor
entity   "Oracle ERP"          as erp

note over Consumer, dataserver
  Consumer has previously been provided with an authentication
  token and provides their authentication header in every HTTP request.
end note
== Initial Action Request ==

autonumber 1 1 "<b>## : </b>"
Consumer -> dataserver ++ : GraphQL API Request
note over dataserver
  * Validates X-API-Key
  * Obtains Consumer's GraphQL ID
  * Obtains and Applies Consumer's AuthZ
  * Validates request data
  * Assigns unique ID to Request
end note
dataserver -> db : Submits request to queue for processing
dataserver - -> Consumer - - : Returns response with ID\nand status check info

== Message Processing ==

db -> kafka : Pulls pending requests into queue
' group Process Action Request Topic [For Each]
  kafka -> processor ++ : Processor picks up request
  note over processor
    * Data validation
    * Formats request for submission to ERP
  end note
  processor -> erp ++ : Submits Request
  erp - -> processor - - : Receives Results
  processor -> db - - : Updates Request status and results
  ' group If Callback URL Provided
  '   processor -> kafka - - : Submits callback action to queue
  ' end group
' end group

== Action Request Response ==

' alt If Provided Callback URL
'   group Process Callback Submit Topic [For Each]
'     kafka -> processor ++ : Picks up Request
'     processor -> Consumer : Sends results to callback URL
'     processor -> db - - : Updates Request Status
'   end group
' else If No Callback URL
  Consumer -> dataserver ++ : GraphQL API Request

  dataserver -> db : Looks up Request Status
  db - -> dataserver : Receives Request Status

  dataserver - -> Consumer - - : Returns response with ID\nand status check info
' end alt

@enduml

@startuml action-request-flow
























skinparam DefaultFontName Avenir

skinparam activity {
    BackgroundColor #FFE599
    BorderColor #033266
    StartColor #266041
    FontColor black
    EndColor #79242F
}

skinparam actor {
    BackgroundColor #FFE599
    BorderColor #033266
    FontColor #002851
    FontStyle bold
}

skinparam arrow {
    Color #002851
    FontSize 10
    FontColor #4C4C4C
}

skinparam box {
    Padding 10
}

skinparam boundary {
    BorderColor black
    BackgroundColor #FFE599
    FontColor #002851
    FontStyle bold
}

skinparam cloud {
    BackgroundColor #6FCFEB
    BorderColor #003A5D
}

skinparam collections {
    BackgroundColor #FFE599
    BorderColor black
}

skinparam component {
    Style uml2
    FontColor #002851
    BackgroundColor #CDD6E0
    BorderColor #002851
}

skinparam control {
    BackgroundColor #FFE599
    BorderColor black
    FontColor #002851
    FontStyle bold
}

skinparam database {
    BackgroundColor #FFE599
    BorderColor black
    FontColor #002851
    FontStyle bold
}

skinparam entity {
    BackgroundColor #FFE599
    BorderColor black
    FontColor #002851
    FontStyle bold
}

skinparam interface {
    BackgroundColor black
    BorderColor #FFBF00
}

skinparam note {
    BackgroundColor #CDD6E0
    BorderColor #1D4776
}

skinparam package {
    BackgroundColor #FFF2CC
}

skinparam participant {
    BackgroundColor #FFE599
    BorderColor black
    Padding 10
    FontColor #002851
    FontStyle bold
}

skinparam queue {
    BackgroundColor #FFE599
    BorderColor black
    FontColor #002851
    FontStyle bold
}

skinparam sequence {
    DividerBorderColor #033266
    group {
      BackgroundColor #FFF9E5
      FontColor #002851
      BorderColor #1D4776
    }
    LifeLineBorderColor #1D4776
    LifeLineBackgroundColor #FFE599
    ArrowThickness 2
    box {
      FontColor #002851
      FontStyle bold
      FontSize 18
      BackgroundColor #FFF9E5
      BorderColor black
    }
    divider {
      FontColor black
      FontStyle bold
      FontSize 14
      BackgroundColor #CDD6E0
      BorderColor #002851
    }
}

skinparam swimlane {
    BorderColor #FFBF00
    TitleFontStyle bold
}

title Action Request Flow Sequence Diagram
center footer Author: Jonathan Keller 2/1/2022

actor    "API Consumer"        as Consumer
control  "API Server"          as dataserver
database "Request Store"       as db
queue    "Action Queue"        as kafka
control  "Action Processors"   as processor
entity   "Oracle ERP"          as erp

note over Consumer, dataserver
  Consumer has previously been provided with an authentication
  token and provides their authentication header in every HTTP request.
end note
== Initial Action Request ==

autonumber 1 1 "<b>## : </b>"
Consumer -> dataserver ++ : GraphQL API Request
note over dataserver
  * Validates X-API-Key
  * Obtains Consumer's GraphQL ID
  * Obtains and Applies Consumer's AuthZ
  * Validates request data
  * Assigns unique ID to Request
end note
dataserver -> db : Submits request to queue for processing
dataserver - -> Consumer - - : Returns response with ID\nand status check info

== Message Processing ==

db -> kafka : Pulls pending requests into queue
  kafka -> processor ++ : Processor picks up request
  note over processor
    * Data validation
    * Formats request for submission to ERP
  end note
  processor -> erp ++ : Submits Request
  erp - -> processor - - : Receives Results
  processor -> db - - : Updates Request status and results

== Action Request Response ==

  Consumer -> dataserver ++ : GraphQL API Request

  dataserver -> db : Looks up Request Status
  db - -> dataserver : Receives Request Status

  dataserver - -> Consumer - - : Returns response with ID\nand status check info

@enduml

PlantUML version 1.2022.3(Tue Mar 29 09:10:57 PDT 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>